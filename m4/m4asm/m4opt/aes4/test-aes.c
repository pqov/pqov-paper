#include <stdlib.h>
#include "randombytes.h"
#include "hal.h"
#include "aes4-publicinputs.h"


static const unsigned char ctref[48] = {
                        0x33,0x35,0x35,0x97,0x51,0x56,0x56,0xf4,0x33,0x35,0x35,
                        0x97,0x51,0x56,0x56,0xf4,0x7c,0xe1,0xd9,0xb7,0x06,0x94,
                        0x6b,0x41,0xa8,0x0e,0xb3,0x2c,0x6a,0xd8,0x24,0x41,0x12,
                        0x58,0xd2,0x53,0x91,0xbc,0xc1,0xa7,0x38,0x99,0xe1,0x12,
                        0x1c,0xd3,0xdf,0x20};

static const unsigned char ctref2[48] = {
                        0x56,0xcc,0x26,0x75,0xf0,0x6d,0x47,0x8f,0x14,0x8e,0x64,
                        0x37,0xb2,0x2f,0x05,0xcd,0x6c,0x28,0xb9,0x8c,0xba,0xf4,
                        0x8f,0xce,0x5d,0xe5,0x59,0x50,0x23,0x25,0x6b,0x1f,0xce,
                        0xc9,0xf6,0x72,0xc3,0x68,0x76,0xe9,0x1d,0xd9,0x49,0x5b,
                        0xaf,0x2d,0x9a,0xd5};

static void test(void){

    unsigned char key[32] = {0};
    unsigned char msg[48] = {0};
    unsigned char nonce[12] = {0};
    unsigned char ct[48];

    aes256_4rounds_ctx_publicinputs ctx;
    aes256_4rounds_ctr_keyexp_publicinputs(&ctx, key);
    aes256_4rounds_ctr_publicinputs(ct, 48, nonce, 0, &ctx);


    if(memcmp(ct, ctref, sizeof ctref)){
        hal_send_str("ERROR 1");
    } else {
        hal_send_str("OK 1");
    }

    memset(key, 0x42, sizeof key);
    aes256_4rounds_ctr_keyexp_publicinputs(&ctx, key);
    aes256_4rounds_ctr_publicinputs(ct, 48, nonce, 0, &ctx);


    if(memcmp(ct, ctref2, sizeof ctref)){
        hal_send_str("ERROR 2");
    } else {
        hal_send_str("OK 2");
    }

}


int main(void){
    hal_setup(CLOCK_BENCHMARK);
    hal_send_str("==========================\n");
    test();
    hal_send_str("#\n");
    while(1);
    return 0;
}